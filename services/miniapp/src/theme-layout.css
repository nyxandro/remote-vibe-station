/**
 * Theme and layout extensions for Mini App.
 * Keeps new UI features outside legacy `styles.css` to contain complexity.
 */

/* Theme tokens for day/night modes; dark mode overrides are selector-driven. */
:root {
  --focus-ring: 0 0 0 3px rgba(27, 108, 255, 0.2);
  --toolbar-bg: #f8faff;
}

/* Explicit focus ring for keyboard accessibility on custom inputs/buttons. */
.input:focus,
.input:focus-visible,
.icon-tool-btn:focus,
.icon-tool-btn:focus-visible,
.stream-toggle:focus,
.stream-toggle:focus-visible,
.terminal-send-btn:focus,
.terminal-send-btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

/* Active project header row: name left, stream action right. */
.active-project-line {
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Stream toggle keeps one-click behavior in project context. */
.stream-toggle {
  border: 1px solid #9db8ff;
  background: #ffffff;
  color: #1b3f91;
  border-radius: 999px;
  width: 30px;
  height: 30px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.stream-toggle:disabled {
  cursor: not-allowed;
  opacity: 0.55;
}

.stream-toggle-on {
  color: #065f46;
  border-color: #86efac;
  background: #ecfdf5;
}

/* File toolbar becomes a compact icon strip for future tools. */
.files-toolbar {
  background: var(--toolbar-bg);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 6px;
}

.icon-tool-btn {
  width: 30px;
  height: 30px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: #ffffff;
  color: #1c2230;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.icon-tool-btn:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}

/* Keep path visible but flexible between compact icon buttons. */
.files-path {
  margin: 0 6px;
  flex: 1 1 auto;
}

/* Terminal occupies the whole viewport section with messenger-like input dock. */
.terminal-shell {
  min-height: max(300px, calc(100vh - 185px));
  height: max(300px, calc(100vh - 185px));
}

.terminal-output {
  flex: 1 1 auto;
  min-height: 300px;
  max-height: none;
  margin: 0;
}

.terminal-input-row {
  margin-top: 10px;
}

.terminal-send-btn {
  width: 38px;
  height: 38px;
  border-radius: 999px;
  border: 1px solid var(--accent);
  background: var(--accent);
  color: #ffffff;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.terminal-send-btn:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}

/* Settings tab keeps a simple split action for theme mode. */
.settings-shell {
  padding: 8px 0;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.settings-header-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.settings-accordion-item {
  border: 1px solid var(--border);
  border-radius: 12px;
  background: #f8fbff;
  overflow: hidden;
}

.settings-accordion-item > summary {
  cursor: pointer;
  list-style: none;
  padding: 10px 12px;
  font-weight: 600;
}

.settings-accordion-item > summary::-webkit-details-marker {
  display: none;
}

.settings-accordion-body {
  padding: 0 12px 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.settings-create-row,
.settings-actions-grid {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.settings-input-compact {
  /* Prevent vertical stretching when .input appears inside column flex containers. */
  flex: 0 0 auto;
  width: 100%;
  min-height: 40px;
}

.settings-editor-card {
  border: 1px solid var(--border);
  border-radius: 12px;
  background: #f8fbff;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.settings-editor-meta {
  font-size: 11px;
  color: var(--text-muted);
  word-break: break-all;
}

/* Header groups file path and language badge to mimic editor chrome. */
.settings-editor-header-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

/* Language label helps identify syntax mode at a glance. */
.settings-editor-language {
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: 3px 8px;
  font-size: 0.6875rem;
  color: var(--text-muted);
  white-space: nowrap;
}

.settings-theme-toggle {
  display: inline-flex;
  gap: 10px;
  flex-wrap: wrap;
}

.settings-theme-toggle .btn.active {
  border-color: var(--accent);
  background: #eef3ff;
}

/* Animated state makes long save requests visible without guessing. */
.settings-save-btn.is-busy {
  position: relative;
  overflow: hidden;
}

/* Subtle moving sheen indicates in-flight save operation. */
.settings-save-btn.is-busy::after {
  content: "";
  position: absolute;
  top: 0;
  left: -120%;
  width: 70%;
  height: 100%;
  background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.38) 50%, transparent 100%);
  animation: settingsSaveSweep 1.1s linear infinite;
}

/* Inline save hint sits directly under action buttons for immediate context. */
.settings-save-status {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 0.8125rem;
  color: var(--text-muted);
}

/* Pulse dot reinforces that request is still in progress. */
.settings-save-dot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: var(--accent);
  animation: settingsSavePulse 0.9s ease-in-out infinite;
}

/* Floating toast provides explicit success/error confirmation after save. */
.settings-toast {
  position: fixed;
  right: 18px;
  bottom: 18px;
  z-index: 1300;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: #f8fbff;
  padding: 10px 12px;
  font-size: 0.8125rem;
  box-shadow: 0 12px 26px rgba(8, 17, 35, 0.22);
  animation: settingsToastIn 0.2s ease-out;
}

/* Success tone for save-confirmation toast. */
.settings-toast.success {
  border-color: #9ae6b4;
  background: #f0fff4;
  color: #0f5132;
}

/* Error tone for save-failure toast. */
.settings-toast.error {
  border-color: #f3b4b4;
  background: #fff5f5;
  color: #8d1f31;
}

@keyframes settingsSaveSweep {
  from {
    left: -120%;
  }
  to {
    left: 140%;
  }
}

@keyframes settingsSavePulse {
  0% {
    transform: scale(0.84);
    opacity: 0.55;
  }
  60% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(0.84);
    opacity: 0.55;
  }
}

@keyframes settingsToastIn {
  from {
    transform: translateY(8px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.settings-editor-modal-backdrop {
  position: fixed;
  inset: 0;
  z-index: 1000;
  background: rgba(3, 8, 20, 0.72);
  display: flex;
  align-items: stretch;
  justify-content: center;
  padding: 18px;
}

.settings-editor-modal {
  width: min(1400px, 100%);
  height: 100%;
  border: 1px solid var(--border);
  border-radius: 16px;
  background: #f8fbff;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.settings-editor-modal-header,
.settings-editor-modal-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 12px;
  border-bottom: 1px solid var(--border);
}

.settings-editor-modal-footer {
  border-top: 1px solid var(--border);
  border-bottom: 0;
  justify-content: flex-end;
}

/* Footer keeps status and actions aligned like desktop editors. */
.settings-editor-actions {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

/* Status line reports dirty/saved/error state and shortcut hint. */
.settings-editor-status {
  margin-right: auto;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  font-size: 0.8125rem;
  color: var(--text-muted);
}

/* Error state uses stronger color for immediate attention. */
.settings-editor-status.error {
  color: #b84255;
}

/* Shortcut badge keeps keyboard workflow discoverable. */
.settings-editor-shortcut {
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 2px 6px;
  font-size: 0.6875rem;
}

.settings-editor-modal-body {
  flex: 1;
  min-height: 0;
  padding: 12px;
}

/* Let CodeMirror occupy full modal body height without dead space. */
.settings-editor-modal-body > .cm-theme {
  height: 100%;
}

.settings-editor-modal-body > .cm-theme .cm-editor {
  height: 100%;
}

/* Dark theme palette tuned for readability in dense admin UI. */
html[data-theme="dark"] {
  color-scheme: dark;
}

html[data-theme="dark"] body,
html[data-theme="dark"] .app-shell,
html[data-theme="dark"] .panel {
  background: #0b1220;
  color: #e6edf7;
}

html[data-theme="dark"] .panel-title,
html[data-theme="dark"] .project-name,
html[data-theme="dark"] .status-title,
html[data-theme="dark"] .active-project-name,
html[data-theme="dark"] .file-name {
  color: #f4f8ff;
}

html[data-theme="dark"] .active-project-path,
html[data-theme="dark"] .active-project-hint,
html[data-theme="dark"] .project-path,
html[data-theme="dark"] .files-path,
html[data-theme="dark"] .files-preview-title,
html[data-theme="dark"] .toggle {
  color: #a2b0c8;
}

html[data-theme="dark"] .project-health-healthy {
  color: #9ff0ce;
  border-color: #1d5f4c;
  background: #113128;
}

html[data-theme="dark"] .project-health-partial {
  color: #f7df9c;
  border-color: #7b5d1a;
  background: #3b2f10;
}

html[data-theme="dark"] .project-health-down {
  color: #ffc4ce;
  border-color: #6f2d39;
  background: #32191f;
}

html[data-theme="dark"] .project-git-plus {
  color: #9ff0ce;
}

html[data-theme="dark"] .project-git-minus {
  color: #ffc4ce;
}

html[data-theme="dark"] .tab,
html[data-theme="dark"] .btn,
html[data-theme="dark"] .icon-tool-btn,
html[data-theme="dark"] .input,
html[data-theme="dark"] .files-list,
html[data-theme="dark"] .status-card,
html[data-theme="dark"] .placeholder,
html[data-theme="dark"] .codebox,
html[data-theme="dark"] .project-card,
html[data-theme="dark"] .files-toolbar,
html[data-theme="dark"] .settings-accordion-item,
html[data-theme="dark"] .settings-editor-card,
html[data-theme="dark"] .settings-editor-modal,
html[data-theme="dark"] .project-create-panel,
html[data-theme="dark"] .project-create-menu {
  background: #131d31;
  border-color: #233352;
  color: #d9e3f5;
}

html[data-theme="dark"] .settings-editor-modal-backdrop {
  background: rgba(3, 8, 20, 0.84);
}

/* Dark palette keeps toast/status contrast at the same hierarchy as other panels. */
html[data-theme="dark"] .settings-save-status {
  color: #b8c7e3;
}

html[data-theme="dark"] .settings-toast {
  background: #131d31;
  border-color: #233352;
  color: #d9e3f5;
  box-shadow: 0 14px 30px rgba(0, 0, 0, 0.45);
}

html[data-theme="dark"] .settings-toast.success {
  border-color: #1d5f4c;
  background: #113128;
  color: #9ff0ce;
}

html[data-theme="dark"] .settings-toast.error {
  border-color: #6f2d39;
  background: #32191f;
  color: #ffc4ce;
}

/* Dark mode mirrors editor chrome semantics for language/shortcut badges. */
html[data-theme="dark"] .settings-editor-language,
html[data-theme="dark"] .settings-editor-shortcut {
  border-color: #2e4b7b;
  color: #b8c7e3;
}

html[data-theme="dark"] .settings-editor-status.error {
  color: #ffc4ce;
}

html[data-theme="dark"] .tab.active,
html[data-theme="dark"] .settings-theme-toggle .btn.active {
  background: #1b2c49;
  border-color: #2e4b7b;
  color: #ffffff;
}

html[data-theme="dark"] .file-item,
html[data-theme="dark"] .file-item.dir {
  background: #131d31;
  border-bottom-color: #233352;
}

html[data-theme="dark"] .stream-toggle {
  background: #131d31;
  border-color: #2e4b7b;
  color: #b9ceef;
}

html[data-theme="dark"] .stream-toggle-on {
  background: #113128;
  border-color: #1d5f4c;
  color: #9ff0ce;
}

html[data-theme="dark"] .file-item:hover {
  background: #1b2a45;
}

html[data-theme="dark"] .alert {
  background: #32191f;
  border-color: #6f2d39;
  color: #ffc4ce;
}

html[data-theme="dark"] .log-box {
  background: #030712;
  border-color: #1f2a44;
  color: #e2e8f0;
}

@media (max-width: 640px) {
  /* On small screens, preserve comfortable terminal height and controls spacing. */
  .terminal-shell {
    min-height: max(300px, calc(100vh - 210px));
    height: max(300px, calc(100vh - 210px));
  }

  .files-toolbar {
    padding: 5px;
  }

  .icon-tool-btn {
    width: 28px;
    height: 28px;
  }

  .settings-editor-modal-backdrop {
    padding: 0;
  }

  .settings-editor-modal {
    border-radius: 0;
    border-left: 0;
    border-right: 0;
  }
}
